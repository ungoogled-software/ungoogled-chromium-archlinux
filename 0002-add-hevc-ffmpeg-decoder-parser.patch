From ce5d582e1b7b967754e91f4f92785d1b7c273b30 Mon Sep 17 00:00:00 2001
From: Sta Zhu <zhusidayoyo@hotmail.com>
Date: Wed, 10 Sep 2025 22:57:08 +0800
Subject: [PATCH] Video: Add HEVC ffmpeg decoder & parser

Add ffmpeg software decoder and parser for HEVC, this will make
sure those users using macOS version < 11 or Windows < 8 or those
users who disabled gpu acceleration or hardware not supported
profiles to have software HEVC decoding ability.
---

diff --git a/third_party/ffmpeg/chromium/config/Chrome/linux/ia32/config.h b/third_party/ffmpeg/chromium/config/Chrome/linux/ia32/config.h
index 14a0dce..90be9fc 100644
--- a/third_party/ffmpeg/chromium/config/Chrome/linux/ia32/config.h
+++ b/third_party/ffmpeg/chromium/config/Chrome/linux/ia32/config.h
@@ -1,7 +1,7 @@
 /* Automatically generated by configure - do not modify! */
 #ifndef FFMPEG_CONFIG_H
 #define FFMPEG_CONFIG_H
-/* #define FFMPEG_CONFIGURATION "--disable-everything --disable-all --disable-doc --disable-htmlpages --disable-manpages --disable-podpages --disable-txtpages --disable-static --enable-avcodec --enable-avformat --enable-avutil --enable-static --enable-libopus --disable-debug --disable-bzlib --disable-error-resilience --disable-iconv --disable-network --disable-schannel --disable-sdl2 --disable-symver --disable-xlib --disable-zlib --disable-securetransport --disable-faan --disable-alsa --disable-iamf --disable-autodetect --enable-decoder='vorbis,libopus,flac' --enable-decoder='pcm_u8,pcm_s16le,pcm_s24le,pcm_s32le,pcm_f32le,mp3' --enable-decoder='pcm_s16be,pcm_s24be,pcm_mulaw,pcm_alaw' --enable-demuxer='ogg,matroska,wav,flac,mp3,mov' --enable-parser='opus,vorbis,flac,mpegaudio,vp9' --extra-cflags=-I/usr/local/google/home/ezemtsov/projects/chromium/src/third_party/opus/src/include --disable-linux-perf --x86asmexe=nasm --optflags='\"-O2\"' --arch=i686 --extra-cflags='\"-m32\"' --extra-ldflags='\"-m32\"' --enable-pic --cc=clang --cxx=clang++ --ld=clang --enable-decoder='aac,h264' --enable-demuxer=aac --enable-parser='aac,h264'" -- elide long configuration string from binary */
+/* #define FFMPEG_CONFIGURATION "--disable-everything --disable-all --disable-doc --disable-htmlpages --disable-manpages --disable-podpages --disable-txtpages --disable-static --enable-avcodec --enable-avformat --enable-avutil --enable-static --enable-libopus --disable-debug --disable-bzlib --disable-error-resilience --disable-iconv --disable-network --disable-schannel --disable-sdl2 --disable-symver --disable-xlib --disable-zlib --disable-securetransport --disable-faan --disable-alsa --disable-iamf --disable-autodetect --enable-decoder='vorbis,libopus,flac' --enable-decoder='pcm_u8,pcm_s16le,pcm_s24le,pcm_s32le,pcm_f32le,mp3' --enable-decoder='pcm_s16be,pcm_s24be,pcm_mulaw,pcm_alaw' --enable-demuxer='ogg,matroska,wav,flac,mp3,mov' --enable-parser='opus,vorbis,flac,mpegaudio,vp9' --extra-cflags=-I/usr/local/google/home/ezemtsov/projects/chromium/src/third_party/opus/src/include --disable-linux-perf --x86asmexe=nasm --optflags='\"-O2\"' --arch=i686 --extra-cflags='\"-m32\"' --extra-ldflags='\"-m32\"' --enable-pic --cc=clang --cxx=clang++ --ld=clang --enable-decoder='aac,h264,hevc' --enable-demuxer=aac --enable-parser='aac,h264,hevc'" -- elide long configuration string from binary */
 #define FFMPEG_LICENSE "LGPL version 2.1 or later"
 #define CONFIG_THIS_YEAR 2025
 #define FFMPEG_DATADIR "/usr/local/share/ffmpeg"
@@ -693,7 +693,7 @@
 #define CONFIG_AUDIO_FRAME_QUEUE 0
 #define CONFIG_AUDIODSP 0
 #define CONFIG_BLOCKDSP 0
-#define CONFIG_BSWAPDSP 0
+#define CONFIG_BSWAPDSP 1
 #define CONFIG_CABAC 1
 #define CONFIG_CBS 0
 #define CONFIG_CBS_APV 0
@@ -730,8 +730,8 @@
 #define CONFIG_H264PRED 1
 #define CONFIG_H264QPEL 1
 #define CONFIG_H264_SEI 1
-#define CONFIG_HEVCPARSE 0
-#define CONFIG_HEVC_SEI 0
+#define CONFIG_HEVCPARSE 1
+#define CONFIG_HEVC_SEI 1
 #define CONFIG_HPELDSP 0
 #define CONFIG_HUFFMAN 0
 #define CONFIG_HUFFYUVDSP 0
diff --git a/third_party/ffmpeg/chromium/config/Chrome/linux/ia32/config_components.h b/third_party/ffmpeg/chromium/config/Chrome/linux/ia32/config_components.h
index 6dd25c4..187c230 100644
--- a/third_party/ffmpeg/chromium/config/Chrome/linux/ia32/config_components.h
+++ b/third_party/ffmpeg/chromium/config/Chrome/linux/ia32/config_components.h
@@ -140,7 +140,7 @@
 #define CONFIG_H264_QSV_DECODER 0
 #define CONFIG_H264_RKMPP_DECODER 0
 #define CONFIG_HAP_DECODER 0
-#define CONFIG_HEVC_DECODER 0
+#define CONFIG_HEVC_DECODER 1
 #define CONFIG_HEVC_QSV_DECODER 0
 #define CONFIG_HEVC_RKMPP_DECODER 0
 #define CONFIG_HEVC_V4L2M2M_DECODER 0
@@ -1023,7 +1023,7 @@
 #define CONFIG_H261_PARSER 0
 #define CONFIG_H263_PARSER 0
 #define CONFIG_H264_PARSER 1
-#define CONFIG_HEVC_PARSER 0
+#define CONFIG_HEVC_PARSER 1
 #define CONFIG_HDR_PARSER 0
 #define CONFIG_IPU_PARSER 0
 #define CONFIG_JPEG2000_PARSER 0
diff --git a/third_party/ffmpeg/chromium/config/Chrome/linux/ia32/libavcodec/codec_list.c b/third_party/ffmpeg/chromium/config/Chrome/linux/ia32/libavcodec/codec_list.c
index fe5adb0..c9666ae 100644
--- a/third_party/ffmpeg/chromium/config/Chrome/linux/ia32/libavcodec/codec_list.c
+++ b/third_party/ffmpeg/chromium/config/Chrome/linux/ia32/libavcodec/codec_list.c
@@ -14,4 +14,5 @@ static const FFCodec * const codec_list[] = {
     &ff_pcm_s32le_decoder,
     &ff_pcm_u8_decoder,
     &ff_libopus_decoder,
+    &ff_hevc_decoder,
     NULL };
diff --git a/third_party/ffmpeg/chromium/config/Chrome/linux/ia32/libavcodec/parser_list.c b/third_party/ffmpeg/chromium/config/Chrome/linux/ia32/libavcodec/parser_list.c
index 3e4fa9c..c85087a 100644
--- a/third_party/ffmpeg/chromium/config/Chrome/linux/ia32/libavcodec/parser_list.c
+++ b/third_party/ffmpeg/chromium/config/Chrome/linux/ia32/libavcodec/parser_list.c
@@ -6,4 +6,5 @@ static const AVCodecParser * const parser_list[] = {
     &ff_opus_parser,
     &ff_vorbis_parser,
     &ff_vp9_parser,
+    &ff_hevc_parser,
     NULL };
diff --git a/third_party/ffmpeg/chromium/config/Chrome/linux/x64/config.h b/third_party/ffmpeg/chromium/config/Chrome/linux/x64/config.h
index 6a321cd..b79c3fe 100644
--- a/third_party/ffmpeg/chromium/config/Chrome/linux/x64/config.h
+++ b/third_party/ffmpeg/chromium/config/Chrome/linux/x64/config.h
@@ -1,7 +1,7 @@
 /* Automatically generated by configure - do not modify! */
 #ifndef FFMPEG_CONFIG_H
 #define FFMPEG_CONFIG_H
-/* #define FFMPEG_CONFIGURATION "--disable-everything --disable-all --disable-doc --disable-htmlpages --disable-manpages --disable-podpages --disable-txtpages --disable-static --enable-avcodec --enable-avformat --enable-avutil --enable-static --enable-libopus --disable-debug --disable-bzlib --disable-error-resilience --disable-iconv --disable-network --disable-schannel --disable-sdl2 --disable-symver --disable-xlib --disable-zlib --disable-securetransport --disable-faan --disable-alsa --disable-iamf --disable-autodetect --enable-decoder='vorbis,libopus,flac' --enable-decoder='pcm_u8,pcm_s16le,pcm_s24le,pcm_s32le,pcm_f32le,mp3' --enable-decoder='pcm_s16be,pcm_s24be,pcm_mulaw,pcm_alaw' --enable-demuxer='ogg,matroska,wav,flac,mp3,mov' --enable-parser='opus,vorbis,flac,mpegaudio,vp9' --extra-cflags=-I/usr/local/google/home/ezemtsov/projects/chromium/src/third_party/opus/src/include --disable-linux-perf --x86asmexe=nasm --optflags='\"-O2\"' --enable-lto --arch=x86_64 --target-os=linux --enable-pic --cc=clang --cxx=clang++ --ld=clang --extra-ldflags='-fuse-ld=lld' --enable-decoder='aac,h264' --enable-demuxer=aac --enable-parser='aac,h264'" -- elide long configuration string from binary */
+/* #define FFMPEG_CONFIGURATION "--disable-everything --disable-all --disable-doc --disable-htmlpages --disable-manpages --disable-podpages --disable-txtpages --disable-static --enable-avcodec --enable-avformat --enable-avutil --enable-static --enable-libopus --disable-debug --disable-bzlib --disable-error-resilience --disable-iconv --disable-network --disable-schannel --disable-sdl2 --disable-symver --disable-xlib --disable-zlib --disable-securetransport --disable-faan --disable-alsa --disable-iamf --disable-autodetect --enable-decoder='vorbis,libopus,flac' --enable-decoder='pcm_u8,pcm_s16le,pcm_s24le,pcm_s32le,pcm_f32le,mp3' --enable-decoder='pcm_s16be,pcm_s24be,pcm_mulaw,pcm_alaw' --enable-demuxer='ogg,matroska,wav,flac,mp3,mov' --enable-parser='opus,vorbis,flac,mpegaudio,vp9' --extra-cflags=-I/usr/local/google/home/ezemtsov/projects/chromium/src/third_party/opus/src/include --disable-linux-perf --x86asmexe=nasm --optflags='\"-O2\"' --enable-lto --arch=x86_64 --target-os=linux --enable-pic --cc=clang --cxx=clang++ --ld=clang --extra-ldflags='-fuse-ld=lld' --enable-decoder='aac,h264,hevc' --enable-demuxer=aac --enable-parser='aac,h264,hevc'" -- elide long configuration string from binary */
 #define FFMPEG_LICENSE "LGPL version 2.1 or later"
 #define CONFIG_THIS_YEAR 2025
 #define FFMPEG_DATADIR "/usr/local/share/ffmpeg"
@@ -693,7 +693,7 @@
 #define CONFIG_AUDIO_FRAME_QUEUE 0
 #define CONFIG_AUDIODSP 0
 #define CONFIG_BLOCKDSP 0
-#define CONFIG_BSWAPDSP 0
+#define CONFIG_BSWAPDSP 1
 #define CONFIG_CABAC 1
 #define CONFIG_CBS 0
 #define CONFIG_CBS_APV 0
@@ -730,8 +730,8 @@
 #define CONFIG_H264PRED 1
 #define CONFIG_H264QPEL 1
 #define CONFIG_H264_SEI 1
-#define CONFIG_HEVCPARSE 0
-#define CONFIG_HEVC_SEI 0
+#define CONFIG_HEVCPARSE 1
+#define CONFIG_HEVC_SEI 1
 #define CONFIG_HPELDSP 0
 #define CONFIG_HUFFMAN 0
 #define CONFIG_HUFFYUVDSP 0
diff --git a/third_party/ffmpeg/chromium/config/Chrome/linux/x64/config_components.h b/third_party/ffmpeg/chromium/config/Chrome/linux/x64/config_components.h
index 6dd25c4..187c230 100644
--- a/third_party/ffmpeg/chromium/config/Chrome/linux/x64/config_components.h
+++ b/third_party/ffmpeg/chromium/config/Chrome/linux/x64/config_components.h
@@ -140,7 +140,7 @@
 #define CONFIG_H264_QSV_DECODER 0
 #define CONFIG_H264_RKMPP_DECODER 0
 #define CONFIG_HAP_DECODER 0
-#define CONFIG_HEVC_DECODER 0
+#define CONFIG_HEVC_DECODER 1
 #define CONFIG_HEVC_QSV_DECODER 0
 #define CONFIG_HEVC_RKMPP_DECODER 0
 #define CONFIG_HEVC_V4L2M2M_DECODER 0
@@ -1023,7 +1023,7 @@
 #define CONFIG_H261_PARSER 0
 #define CONFIG_H263_PARSER 0
 #define CONFIG_H264_PARSER 1
-#define CONFIG_HEVC_PARSER 0
+#define CONFIG_HEVC_PARSER 1
 #define CONFIG_HDR_PARSER 0
 #define CONFIG_IPU_PARSER 0
 #define CONFIG_JPEG2000_PARSER 0
diff --git a/third_party/ffmpeg/chromium/config/Chrome/linux/x64/libavcodec/codec_list.c b/third_party/ffmpeg/chromium/config/Chrome/linux/x64/libavcodec/codec_list.c
index fe5adb0..c9666ae 100644
--- a/third_party/ffmpeg/chromium/config/Chrome/linux/x64/libavcodec/codec_list.c
+++ b/third_party/ffmpeg/chromium/config/Chrome/linux/x64/libavcodec/codec_list.c
@@ -14,4 +14,5 @@ static const FFCodec * const codec_list[] = {
     &ff_pcm_s32le_decoder,
     &ff_pcm_u8_decoder,
     &ff_libopus_decoder,
+    &ff_hevc_decoder,
     NULL };
diff --git a/third_party/ffmpeg/chromium/config/Chrome/linux/x64/libavcodec/parser_list.c b/third_party/ffmpeg/chromium/config/Chrome/linux/x64/libavcodec/parser_list.c
index 3e4fa9c..c85087a 100644
--- a/third_party/ffmpeg/chromium/config/Chrome/linux/x64/libavcodec/parser_list.c
+++ b/third_party/ffmpeg/chromium/config/Chrome/linux/x64/libavcodec/parser_list.c
@@ -6,4 +6,5 @@ static const AVCodecParser * const parser_list[] = {
     &ff_opus_parser,
     &ff_vorbis_parser,
     &ff_vp9_parser,
+    &ff_hevc_parser,
     NULL };
diff --git a/third_party/ffmpeg/chromium/config/Chromium/linux-noasm/x64/config.h b/third_party/ffmpeg/chromium/config/Chromium/linux-noasm/x64/config.h
index 1c5563f..b6b6644 100644
--- a/third_party/ffmpeg/chromium/config/Chromium/linux-noasm/x64/config.h
+++ b/third_party/ffmpeg/chromium/config/Chromium/linux-noasm/x64/config.h
@@ -693,7 +693,7 @@
 #define CONFIG_AUDIO_FRAME_QUEUE 0
 #define CONFIG_AUDIODSP 0
 #define CONFIG_BLOCKDSP 0
-#define CONFIG_BSWAPDSP 0
+#define CONFIG_BSWAPDSP 1
 #define CONFIG_CABAC 0
 #define CONFIG_CBS 0
 #define CONFIG_CBS_APV 0
@@ -730,8 +730,8 @@
 #define CONFIG_H264PRED 0
 #define CONFIG_H264QPEL 0
 #define CONFIG_H264_SEI 0
-#define CONFIG_HEVCPARSE 0
-#define CONFIG_HEVC_SEI 0
+#define CONFIG_HEVCPARSE 1
+#define CONFIG_HEVC_SEI 1
 #define CONFIG_HPELDSP 0
 #define CONFIG_HUFFMAN 0
 #define CONFIG_HUFFYUVDSP 0
diff --git a/third_party/ffmpeg/chromium/config/Chromium/linux-noasm/x64/config_components.h b/third_party/ffmpeg/chromium/config/Chromium/linux-noasm/x64/config_components.h
index 4108b49..3a97180 100644
--- a/third_party/ffmpeg/chromium/config/Chromium/linux-noasm/x64/config_components.h
+++ b/third_party/ffmpeg/chromium/config/Chromium/linux-noasm/x64/config_components.h
@@ -140,7 +140,7 @@
 #define CONFIG_H264_QSV_DECODER 0
 #define CONFIG_H264_RKMPP_DECODER 0
 #define CONFIG_HAP_DECODER 0
-#define CONFIG_HEVC_DECODER 0
+#define CONFIG_HEVC_DECODER 1
 #define CONFIG_HEVC_QSV_DECODER 0
 #define CONFIG_HEVC_RKMPP_DECODER 0
 #define CONFIG_HEVC_V4L2M2M_DECODER 0
@@ -1023,7 +1023,7 @@
 #define CONFIG_H261_PARSER 0
 #define CONFIG_H263_PARSER 0
 #define CONFIG_H264_PARSER 0
-#define CONFIG_HEVC_PARSER 0
+#define CONFIG_HEVC_PARSER 1
 #define CONFIG_HDR_PARSER 0
 #define CONFIG_IPU_PARSER 0
 #define CONFIG_JPEG2000_PARSER 0
diff --git a/third_party/ffmpeg/chromium/config/Chromium/linux-noasm/x64/libavcodec/codec_list.c b/third_party/ffmpeg/chromium/config/Chromium/linux-noasm/x64/libavcodec/codec_list.c
index 7d9debf..f9faf1d 100644
--- a/third_party/ffmpeg/chromium/config/Chromium/linux-noasm/x64/libavcodec/codec_list.c
+++ b/third_party/ffmpeg/chromium/config/Chromium/linux-noasm/x64/libavcodec/codec_list.c
@@ -12,4 +12,5 @@ static const FFCodec * const codec_list[] = {
     &ff_pcm_s32le_decoder,
     &ff_pcm_u8_decoder,
     &ff_libopus_decoder,
+    &ff_hevc_decoder,
     NULL };
diff --git a/third_party/ffmpeg/chromium/config/Chromium/linux-noasm/x64/libavcodec/parser_list.c b/third_party/ffmpeg/chromium/config/Chromium/linux-noasm/x64/libavcodec/parser_list.c
index fdc533b..520472e 100644
--- a/third_party/ffmpeg/chromium/config/Chromium/linux-noasm/x64/libavcodec/parser_list.c
+++ b/third_party/ffmpeg/chromium/config/Chromium/linux-noasm/x64/libavcodec/parser_list.c
@@ -4,4 +4,5 @@ static const AVCodecParser * const parser_list[] = {
     &ff_opus_parser,
     &ff_vorbis_parser,
     &ff_vp9_parser,
+    &ff_hevc_parser,
     NULL };
diff --git a/third_party/ffmpeg/chromium/config/Chromium/linux/ia32/config.h b/third_party/ffmpeg/chromium/config/Chromium/linux/ia32/config.h
index 179a5dc..3e484db 100644
--- a/third_party/ffmpeg/chromium/config/Chromium/linux/ia32/config.h
+++ b/third_party/ffmpeg/chromium/config/Chromium/linux/ia32/config.h
@@ -693,7 +693,7 @@
 #define CONFIG_AUDIO_FRAME_QUEUE 0
 #define CONFIG_AUDIODSP 0
 #define CONFIG_BLOCKDSP 0
-#define CONFIG_BSWAPDSP 0
+#define CONFIG_BSWAPDSP 1
 #define CONFIG_CABAC 0
 #define CONFIG_CBS 0
 #define CONFIG_CBS_APV 0
@@ -730,8 +730,8 @@
 #define CONFIG_H264PRED 0
 #define CONFIG_H264QPEL 0
 #define CONFIG_H264_SEI 0
-#define CONFIG_HEVCPARSE 0
-#define CONFIG_HEVC_SEI 0
+#define CONFIG_HEVCPARSE 1
+#define CONFIG_HEVC_SEI 1
 #define CONFIG_HPELDSP 0
 #define CONFIG_HUFFMAN 0
 #define CONFIG_HUFFYUVDSP 0
diff --git a/third_party/ffmpeg/chromium/config/Chromium/linux/ia32/config_components.h b/third_party/ffmpeg/chromium/config/Chromium/linux/ia32/config_components.h
index 4108b49..3a97180 100644
--- a/third_party/ffmpeg/chromium/config/Chromium/linux/ia32/config_components.h
+++ b/third_party/ffmpeg/chromium/config/Chromium/linux/ia32/config_components.h
@@ -140,7 +140,7 @@
 #define CONFIG_H264_QSV_DECODER 0
 #define CONFIG_H264_RKMPP_DECODER 0
 #define CONFIG_HAP_DECODER 0
-#define CONFIG_HEVC_DECODER 0
+#define CONFIG_HEVC_DECODER 1
 #define CONFIG_HEVC_QSV_DECODER 0
 #define CONFIG_HEVC_RKMPP_DECODER 0
 #define CONFIG_HEVC_V4L2M2M_DECODER 0
@@ -1023,7 +1023,7 @@
 #define CONFIG_H261_PARSER 0
 #define CONFIG_H263_PARSER 0
 #define CONFIG_H264_PARSER 0
-#define CONFIG_HEVC_PARSER 0
+#define CONFIG_HEVC_PARSER 1
 #define CONFIG_HDR_PARSER 0
 #define CONFIG_IPU_PARSER 0
 #define CONFIG_JPEG2000_PARSER 0
diff --git a/third_party/ffmpeg/chromium/config/Chromium/linux/ia32/libavcodec/codec_list.c b/third_party/ffmpeg/chromium/config/Chromium/linux/ia32/libavcodec/codec_list.c
index 7d9debf..f9faf1d 100644
--- a/third_party/ffmpeg/chromium/config/Chromium/linux/ia32/libavcodec/codec_list.c
+++ b/third_party/ffmpeg/chromium/config/Chromium/linux/ia32/libavcodec/codec_list.c
@@ -12,4 +12,5 @@ static const FFCodec * const codec_list[] = {
     &ff_pcm_s32le_decoder,
     &ff_pcm_u8_decoder,
     &ff_libopus_decoder,
+    &ff_hevc_decoder,
     NULL };
diff --git a/third_party/ffmpeg/chromium/config/Chromium/linux/ia32/libavcodec/parser_list.c b/third_party/ffmpeg/chromium/config/Chromium/linux/ia32/libavcodec/parser_list.c
index fdc533b..520472e 100644
--- a/third_party/ffmpeg/chromium/config/Chromium/linux/ia32/libavcodec/parser_list.c
+++ b/third_party/ffmpeg/chromium/config/Chromium/linux/ia32/libavcodec/parser_list.c
@@ -4,4 +4,5 @@ static const AVCodecParser * const parser_list[] = {
     &ff_opus_parser,
     &ff_vorbis_parser,
     &ff_vp9_parser,
+    &ff_hevc_parser,
     NULL };
diff --git a/third_party/ffmpeg/chromium/config/Chromium/linux/x64/config.h b/third_party/ffmpeg/chromium/config/Chromium/linux/x64/config.h
index 2b82b19..3a6833b 100644
--- a/third_party/ffmpeg/chromium/config/Chromium/linux/x64/config.h
+++ b/third_party/ffmpeg/chromium/config/Chromium/linux/x64/config.h
@@ -693,7 +693,7 @@
 #define CONFIG_AUDIO_FRAME_QUEUE 0
 #define CONFIG_AUDIODSP 0
 #define CONFIG_BLOCKDSP 0
-#define CONFIG_BSWAPDSP 0
+#define CONFIG_BSWAPDSP 1
 #define CONFIG_CABAC 0
 #define CONFIG_CBS 0
 #define CONFIG_CBS_APV 0
@@ -730,8 +730,8 @@
 #define CONFIG_H264PRED 0
 #define CONFIG_H264QPEL 0
 #define CONFIG_H264_SEI 0
-#define CONFIG_HEVCPARSE 0
-#define CONFIG_HEVC_SEI 0
+#define CONFIG_HEVCPARSE 1
+#define CONFIG_HEVC_SEI 1
 #define CONFIG_HPELDSP 0
 #define CONFIG_HUFFMAN 0
 #define CONFIG_HUFFYUVDSP 0
diff --git a/third_party/ffmpeg/chromium/config/Chromium/linux/x64/config_components.h b/third_party/ffmpeg/chromium/config/Chromium/linux/x64/config_components.h
index 4108b49..3a97180 100644
--- a/third_party/ffmpeg/chromium/config/Chromium/linux/x64/config_components.h
+++ b/third_party/ffmpeg/chromium/config/Chromium/linux/x64/config_components.h
@@ -140,7 +140,7 @@
 #define CONFIG_H264_QSV_DECODER 0
 #define CONFIG_H264_RKMPP_DECODER 0
 #define CONFIG_HAP_DECODER 0
-#define CONFIG_HEVC_DECODER 0
+#define CONFIG_HEVC_DECODER 1
 #define CONFIG_HEVC_QSV_DECODER 0
 #define CONFIG_HEVC_RKMPP_DECODER 0
 #define CONFIG_HEVC_V4L2M2M_DECODER 0
@@ -1023,7 +1023,7 @@
 #define CONFIG_H261_PARSER 0
 #define CONFIG_H263_PARSER 0
 #define CONFIG_H264_PARSER 0
-#define CONFIG_HEVC_PARSER 0
+#define CONFIG_HEVC_PARSER 1
 #define CONFIG_HDR_PARSER 0
 #define CONFIG_IPU_PARSER 0
 #define CONFIG_JPEG2000_PARSER 0
diff --git a/third_party/ffmpeg/chromium/config/Chromium/linux/x64/libavcodec/codec_list.c b/third_party/ffmpeg/chromium/config/Chromium/linux/x64/libavcodec/codec_list.c
index 7d9debf..f9faf1d 100644
--- a/third_party/ffmpeg/chromium/config/Chromium/linux/x64/libavcodec/codec_list.c
+++ b/third_party/ffmpeg/chromium/config/Chromium/linux/x64/libavcodec/codec_list.c
@@ -12,4 +12,5 @@ static const FFCodec * const codec_list[] = {
     &ff_pcm_s32le_decoder,
     &ff_pcm_u8_decoder,
     &ff_libopus_decoder,
+    &ff_hevc_decoder,
     NULL };
diff --git a/third_party/ffmpeg/chromium/config/Chromium/linux/x64/libavcodec/parser_list.c b/third_party/ffmpeg/chromium/config/Chromium/linux/x64/libavcodec/parser_list.c
index fdc533b..520472e 100644
--- a/third_party/ffmpeg/chromium/config/Chromium/linux/x64/libavcodec/parser_list.c
+++ b/third_party/ffmpeg/chromium/config/Chromium/linux/x64/libavcodec/parser_list.c
@@ -4,4 +4,5 @@ static const AVCodecParser * const parser_list[] = {
     &ff_opus_parser,
     &ff_vorbis_parser,
     &ff_vp9_parser,
+    &ff_hevc_parser,
     NULL };
diff --git a/third_party/ffmpeg/ffmpeg_generated.gni b/third_party/ffmpeg/ffmpeg_generated.gni
index 174173e..238d876 100644
--- a/third_party/ffmpeg/ffmpeg_generated.gni
+++ b/third_party/ffmpeg/ffmpeg_generated.gni
@@ -224,6 +224,27 @@ if (((current_cpu == "arm64" || current_cpu == "arm64e") &&
     (is_apple && ffmpeg_branding == "Chrome") ||
     (is_win && ffmpeg_branding == "Chrome") ||
     (use_linux_config && ffmpeg_branding == "Chrome")) {
+
+  ffmpeg_c_sources += [
+    "libavcodec/aom_film_grain.c",
+    "libavcodec/bswapdsp.c",
+    "libavcodec/dovi_rpu.c",
+    "libavcodec/dovi_rpudec.c",
+    "libavcodec/dynamic_hdr_vivid.c",
+    "libavcodec/hevc/autorename_libavcodec_hevc_parse.c",
+    "libavcodec/hevc/autorename_libavcodec_hevc_parser.c",
+    "libavcodec/hevc/autorename_libavcodec_hevc_cabac.c",
+    "libavcodec/hevc/data.c",
+    "libavcodec/hevc/dsp.c",
+    "libavcodec/hevc/filter.c",
+    "libavcodec/hevc/hevcdec.c",
+    "libavcodec/hevc/mvs.c",
+    "libavcodec/hevc/pred.c",
+    "libavcodec/hevc/ps.c",
+    "libavcodec/hevc/refs.c",
+    "libavcodec/hevc/sei.c"
+  ]
+
   ffmpeg_c_sources += [
     "libavcodec/atsc_a53.c",
     "libavcodec/autorename_libavcodec_videodsp.c",
@@ -473,6 +499,24 @@ if ((current_cpu == "x64" && ffmpeg_branding == "Chrome") ||
     (is_android && current_cpu == "x86" && ffmpeg_branding == "Chrome") ||
     (is_win && current_cpu == "x86" && ffmpeg_branding == "Chrome") ||
     (use_linux_config && current_cpu == "x86" && ffmpeg_branding == "Chrome")) {
+
+  ffmpeg_c_sources += [
+    "libavcodec/x86/bswapdsp_init.c",
+    "libavcodec/x86/hevc/dsp_init.c",
+    "libavcodec/x86/h26x/h2656dsp.c"
+  ]
+
+  ffmpeg_asm_sources += [
+    "libavcodec/x86/bswapdsp.asm",
+    "libavcodec/x86/hevc/add_res.asm",
+    "libavcodec/x86/hevc/deblock.asm",
+    "libavcodec/x86/hevc/idct.asm",
+    "libavcodec/x86/hevc/mc.asm",
+    "libavcodec/x86/hevc/sao.asm",
+    "libavcodec/x86/hevc/sao_10bit.asm",
+    "libavcodec/x86/h26x/h2656_inter.asm"
+  ]
+
   ffmpeg_c_sources += [
     "libavcodec/x86/aacpsdsp_init.c",
     "libavcodec/x86/h264_intrapred_init.c",
diff --git a/third_party/ffmpeg/libavcodec/hevc/autorename_libavcodec_hevc_cabac.c b/third_party/ffmpeg/libavcodec/hevc/autorename_libavcodec_hevc_cabac.c
new file mode 100644
index 0000000..1e6d60f
--- /dev/null
+++ b/third_party/ffmpeg/libavcodec/hevc/autorename_libavcodec_hevc_cabac.c
@@ -0,0 +1 @@
+#include "cabac.c"
diff --git a/third_party/ffmpeg/libavcodec/hevc/autorename_libavcodec_hevc_parse.c b/third_party/ffmpeg/libavcodec/hevc/autorename_libavcodec_hevc_parse.c
new file mode 100644
index 0000000..0ea68af
--- /dev/null
+++ b/third_party/ffmpeg/libavcodec/hevc/autorename_libavcodec_hevc_parse.c
@@ -0,0 +1 @@
+#include "parse.c"
diff --git a/third_party/ffmpeg/libavcodec/hevc/autorename_libavcodec_hevc_parser.c b/third_party/ffmpeg/libavcodec/hevc/autorename_libavcodec_hevc_parser.c
new file mode 100644
index 0000000..c93d907
--- /dev/null
+++ b/third_party/ffmpeg/libavcodec/hevc/autorename_libavcodec_hevc_parser.c
@@ -0,0 +1 @@
+#include "parser.c"
